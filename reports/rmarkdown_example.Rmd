---
title: "Example RMarkdown report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Time series of motor vehicle fatalities

We summed up the daily total number of motor vehicle fatalities in Florida for the weeks 
surrounding the landfall of Hurricane Irma on September 10, 2017. The following 
plot shows the time series of these fatalities: 

```{r echo = FALSE, message = FALSE}
# Load the required packages
library("readr")
library("ggplot2")
library("forcats") 
library("magrittr")
library("dplyr")
library("lubridate")

# Load the data for the example
daily_fatalities <- read_csv("../data/daily_fatalities.csv")

daily_fatalities %<>% 
  mutate(weekday = as_factor(weekday)) %>% 
  mutate(weekday = fct_relevel(weekday, 
                               "Sunday", "Monday", "Tuesday", "Wednesday", 
                               "Thursday", "Friday", "Saturday"))
ggplot(data = daily_fatalities) + 
  geom_line(aes(x = date, y = fatals), color = "darkgray") + 
  geom_point(aes(x = date, y = fatals, color = weekday), size = 2) + 
  expand_limits(y = 0) + 
  scale_color_viridis_d() + 
  labs(x = "Date", y = "# of fatalities", color = "Day of week") + 
  ggtitle("Motor vehicle fatalities in Florida",
          subtitle = "Late summer / early fall of 2019") +
  theme(legend.position = "bottom")
```

# Map of fatal motor vehicle accidents

We also mapped the location of each fatal motor vehicle accident that occurred the
week of landfall: 

```{r echo = FALSE, message = FALSE}
library("readr")
library("sf")
library("tigris")
library("ggplot2")

# Load the data for the examples and convert it to the sf class
fl_accidents <- read_csv("../data/fl_accidents.csv")
fl_accidents %<>% 
  st_as_sf(coords = c("longitud", "latitude")) %>% 
  st_sf(crs = 4326)

irma_tracks <- read_sf("../data/al112017_best_track/", # `read_sf` is similar to `st_read`, but without
                       layer = "al112017_lin") %>%     # messages
  st_transform(crs = 4326)

load("../data/fl_counties.RData") # Load saved data instead of using `tigris`, 
                                  # in case you're running this offline.

ggplot() + 
  geom_sf(data = fl_counties, fill = "antiquewhite") + 
  geom_sf(data = fl_accidents, color = "darkcyan") +
  geom_sf(data = irma_tracks, color = "red") + 
  coord_sf(xlim = c(-88, -80), ylim = c(24.5, 31.5)) + 
  facet_wrap(~ date, ncol = 4) + 
  theme_bw() + 
  theme(panel.background = element_rect(fill = "aliceblue"),
        axis.ticks = element_blank(),
        axis.text = element_blank(),
        panel.grid = element_line(color = "white", size = 0.8))
```


